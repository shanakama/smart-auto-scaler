<div class="container">
  <div class="card">
    <div class="flex justify-between align-center">
      <h2 class="card-header" style="margin-bottom: 0;">Scaling Decisions Log</h2>
      <div class="flex align-center gap-10">
        <label>
          Show:
          <select [(ngModel)]="limit" (change)="loadDecisions()" style="margin-left: 8px; width: 100px;">
            <option [value]="10">10</option>
            <option [value]="25">25</option>
            <option [value]="50">50</option>
            <option [value]="100">100</option>
          </select>
        </label>
        <button class="btn btn-primary" (click)="loadDecisions()">
          Refresh
        </button>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="spinner"></div>

    <!-- Error State -->
    <div *ngIf="error" class="alert alert-danger">
      {{ error }}
    </div>

    <!-- Decisions Table -->
    <div *ngIf="!loading && !error && decisions.length > 0" style="overflow-x: auto;">
      <table>
        <thead>
          <tr>
            <th>Timestamp</th>
            <th>Pod</th>
            <th>Action</th>
            <th>Confidence</th>
            <th>CPU</th>
            <th>Memory</th>
            <th>Usage</th>
            <th>Applied</th>
            <th>Reason</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let decision of decisions">
            <td style="white-space: nowrap;">
              {{ getTimestamp(decision) }}
            </td>
            <td>
              <strong>{{ decision.pod_name }}</strong><br>
              <small style="color: #666;">{{ decision.namespace }}</small>
            </td>
            <td>
              <div *ngIf="hasEnhancedFormat(decision); else singleAction">
                <span class="badge" [ngClass]="getActionClass(decision.cpu_action!)" style="font-size: 10px; margin-bottom: 2px; display: block;">
                  CPU: {{ decision.cpu_action }}
                </span>
                <span class="badge" [ngClass]="getActionClass(decision.memory_action!)" style="font-size: 10px;">
                  MEM: {{ decision.memory_action }}
                </span>
              </div>
              <ng-template #singleAction>
                <span class="badge" [ngClass]="getActionClass(getOverallAction(decision))">
                  {{ getOverallAction(decision) }}
                </span>
              </ng-template>
            </td>
            <td>
              <div style="display: flex; align-items: center; gap: 8px;" *ngIf="getConfidenceObject(decision); else singleConfidence">
                <div>
                  <div style="display: flex; align-items: center; gap: 4px; margin-bottom: 2px;">
                    <small style="width: 30px; color: #666;">CPU:</small>
                    <div style="width: 40px; height: 6px; background: #f0f0f0; border-radius: 3px; overflow: hidden;">
                      <div [style.width.%]="getCpuConfidence(decision) * 100"
                           [style.background]="getConfidenceColor(getCpuConfidence(decision))"
                           style="height: 100%;"></div>
                    </div>
                    <span style="font-size: 10px;">{{ getCpuConfidence(decision) * 100 | number:'1.0-0' }}%</span>
                  </div>
                  <div style="display: flex; align-items: center; gap: 4px;">
                    <small style="width: 30px; color: #666;">MEM:</small>
                    <div style="width: 40px; height: 6px; background: #f0f0f0; border-radius: 3px; overflow: hidden;">
                      <div [style.width.%]="getMemoryConfidence(decision) * 100"
                           [style.background]="getConfidenceColor(getMemoryConfidence(decision))"
                           style="height: 100%;"></div>
                    </div>
                    <span style="font-size: 10px;">{{ getMemoryConfidence(decision) * 100 | number:'1.0-0' }}%</span>
                  </div>
                </div>
              </div>
              <ng-template #singleConfidence>
                <div style="display: flex; align-items: center; gap: 8px;">
                  <div style="width: 60px; height: 8px; background: #f0f0f0; border-radius: 4px; overflow: hidden;">
                    <div [style.width.%]="getOverallConfidence(decision) * 100"
                         [style.background]="getConfidenceColor(getOverallConfidence(decision))"
                         style="height: 100%;"></div>
                  </div>
                  <span>{{ getOverallConfidence(decision) * 100 | number:'1.0-0' }}%</span>
                </div>
              </ng-template>
            </td>
            <td>
              <div>
                <small style="color: #666;">Current:</small> {{ getCurrentCpuCores(decision) | number:'1.3-3' }}<br>
                <small style="color: #666;">Proposed:</small>
                <strong [style.color]="getProposedCpuCores(decision) > getCurrentCpuCores(decision) ? '#2ecc71' : getProposedCpuCores(decision) < getCurrentCpuCores(decision) ? '#e74c3c' : '#3498db'">
                  {{ getProposedCpuCores(decision) | number:'1.3-3' }}
                </strong>
                <div *ngIf="hasCpuChanges(decision)" style="font-size: 10px; color: #666;">
                  {{ getCpuChangePercent(decision) > 0 ? '+' : '' }}{{ getCpuChangePercent(decision) | number:'1.1-1' }}%
                </div>
              </div>
            </td>
            <td>
              <div>
                <small style="color: #666;">Current:</small> {{ getCurrentMemoryMb(decision) | number:'1.1-1' }}MB<br>
                <small style="color: #666;">Proposed:</small>
                <strong [style.color]="getProposedMemoryMb(decision) > getCurrentMemoryMb(decision) ? '#2ecc71' : getProposedMemoryMb(decision) < getCurrentMemoryMb(decision) ? '#e74c3c' : '#3498db'">
                  {{ getProposedMemoryMb(decision) | number:'1.1-1' }}MB
                </strong>
                <div *ngIf="hasMemoryChanges(decision)" style="font-size: 10px; color: #666;">
                  {{ getMemoryChangePercent(decision) > 0 ? '+' : '' }}{{ getMemoryChangePercent(decision) | number:'1.1-1' }}%
                </div>
              </div>
            </td>
            <td>
              <div>
                <small>CPU:</small> {{ getUsageCpuCores(decision) | number:'1.3-3' }}<br>
                <small>Mem:</small> {{ getUsageMemoryMb(decision) | number:'1.1-1' }}MB
                <div *ngIf="decision.utilization" style="font-size: 10px; color: #666; margin-top: 2px;">
                  <div>CPU: {{ decision.utilization.cpu_percentage }}%</div>
                  <div>Mem: {{ decision.utilization.memory_percentage }}%</div>
                </div>
              </div>
            </td>
            <td>
              <span class="badge" [ngClass]="isApplied(decision) ? 'badge-success' : 'badge-warning'">
                {{ isApplied(decision) ? 'Yes' : 'No' }}
              </span>
              <div *ngIf="decision.can_scale === false" style="font-size: 10px; color: #e74c3c; margin-top: 2px;">
                Cannot scale
              </div>
            </td>
            <td style="max-width: 200px;">
              <small>{{ getReason(decision) }}</small>
              <div *ngIf="decision.future_predictions" style="font-size: 10px; color: #666; margin-top: 4px;">
                <div>Future CPU: {{ decision.future_predictions.cpu | number:'1.3-3' }}</div>
                <div>Future Mem: {{ decision.future_predictions.memory | number:'1.3-3' }}</div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !error && decisions.length === 0" class="alert alert-info">
      No scaling decisions recorded yet
    </div>
  </div>
</div>
